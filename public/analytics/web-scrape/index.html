<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link rel="icon" type="image/png" href="/img/favicon.ico">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.74.3" />

    
    
    

<title>Web Scrape • Math, Health, and Other Stuff</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Web Scrape"/>
<meta name="twitter:description" content="Unfortunately, not all data is contained within neat dataframes. Much of the freely accessible data out there is posted on webpages. This post will serve as an introduction on how to extract that data using two packages: rvest and rselenium.
Setup CSS Tool Webpages are not written in R code. They are written in HTML and CSS. A working knowledge of at least CSS is required to use the webscapring packages R provides."/>

<meta property="og:title" content="Web Scrape" />
<meta property="og:description" content="Unfortunately, not all data is contained within neat dataframes. Much of the freely accessible data out there is posted on webpages. This post will serve as an introduction on how to extract that data using two packages: rvest and rselenium.
Setup CSS Tool Webpages are not written in R code. They are written in HTML and CSS. A working knowledge of at least CSS is required to use the webscapring packages R provides." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/analytics/web-scrape/" />
<meta property="article:published_time" content="2020-08-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-05T15:58:56-04:00" /><meta property="og:site_name" content="The Woods of Jeff" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.16fcc2089a2ab10ac8df9820d5dee1901cd3c2ba5989e45dfaf9d546b7dc6536.css" integrity="sha256-FvzCCJoqsQrI35gg1d7hkBzTwrpZieRd&#43;vnVRrfcZTY=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->

    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title" style="font-size:1.65em">
        <a href="/">Math, Health, and Other Stuff</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="/img/coffeeandme_camping.JPG" alt="Author Image" class="img--round element--center">
        </div>
        
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Math, Health, and Other Stuff</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/projects/">
						<span>Projects</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/analytics/">
						<span>Analytics</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/fitness/">
						<span>Fitness</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/recipes/">
						<span>Recipes</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/good_thoughts/">
						<span>Good Thoughts</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	
	
	<a href="https://github.com/jeffcavanagh" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/jeffcavanagh1/" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	<a href="mailto:jmcavanagh15@gmail.com" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2019 - 2020 htr3n
  
</div>



  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Web Scrape</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Aug 5, 2020
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/r">R</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/rvest">rvest</a>
           
      
          <a class="badge badge-tag" href="/tags/rselenium">rselenium</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 15 min read
</div>


  </header>
  
  
  <div class="post">
    


<p><strong>Unfortunately, not all data is contained within neat dataframes. Much of the freely accessible data out there is posted on webpages. This post will serve as an introduction on how to extract that data using two packages: <code>rvest</code> and <code>rselenium</code>.</strong></p>
<div id="setup" class="section level3">
<h3>Setup</h3>
<div id="css-tool" class="section level4">
<h4>CSS Tool</h4>
<p>Webpages are not written in R code. They are written in HTML and CSS. A working knowledge of at least CSS is required to use the webscapring packages R provides.</p>
<p>Luckily for us there are free CSS selector tools to pull the the CSS links we need. I will be using the <a href="https://selectorgadget.com/" target="blank">SelectorGadget</a>.</p>
</div>
<div id="data" class="section level4">
<h4>Data</h4>
<p>The data will be practicing our techniques on is a page from IMDb that lists 50 comic book movies that were released between 2000 and 2019, ranked by popularity. Here was what the page data looks like:</p>
<p><img src="/analytics/2020-08-05-web-scrape_files/Screen%20Shot%202020-08-08%20at%202.43.03%20PM.png" /></p>
<p>The link can be found <a href="https://www.imdb.com/search/keyword/?keywords=based-on-comic-book%2Csuperhero&amp;pf_rd_m=A2FGELUUNOQJNL&amp;pf_rd_p=a581b14c-5a82-4e29-9cf8-54f909ced9e1&amp;pf_rd_r=HA259SA49EFNVTHNRH2V&amp;pf_rd_s=center-5&amp;pf_rd_t=15051&amp;pf_rd_i=genre&amp;ref_=kw_ref_yr&amp;sort=moviemeter,asc&amp;mode=detail&amp;page=1&amp;title_type=movie&amp;release_date=2000%2C2019" target="blank">here</a>.</p>
<p>Our primary goal will be to extract the different elements of data displayed on this page and translate it into a dataframe that is easy to use and manipulate. We will first do so with <code>rvest</code>.</p>
</div>
</div>
<div id="rvest" class="section level3">
<h3><code>rvest</code></h3>
<p>This package provides a host of functions that are designed to extract html code. The first thing we need to do to use it is use <code>read_html</code> to the read the full page.</p>
<pre class="r"><code>library(tidyverse)
library(rvest)
movies &lt;- read_html(&quot;https://www.imdb.com/search/keyword/?keywords=based-on-comic-book%2Csuperhero&amp;pf_rd_m=A2FGELUUNOQJNL&amp;pf_rd_p=a581b14c-5a82-4e29-9cf8-54f909ced9e1&amp;pf_rd_r=HA259SA49EFNVTHNRH2V&amp;pf_rd_s=center-5&amp;pf_rd_t=15051&amp;pf_rd_i=genre&amp;ref_=kw_ref_yr&amp;sort=moviemeter,asc&amp;mode=detail&amp;page=1&amp;title_type=movie&amp;release_date=2000%2C2019&quot;)</code></pre>
<p>Now that is done, we will start to extract different text elements of the page using <code>html_nodes</code> to identify all matches to the input CSS tag and <code>html_text</code> to extract the text. First let’s get all the movie titles.</p>
<p><img src="/analytics/2020-08-05-web-scrape_files/Screen%20Shot%202020-08-08%20at%2012.37.06%20PM.png" /></p>
<pre class="r"><code>titles &lt;- movies %&gt;%
  html_nodes(&quot;.lister-item-header a&quot;) %&gt;%
  html_text()</code></pre>
<p>Using the same approach we can collect the other statistics from each movie. Let’s do that now for each movies popularity ranking, rating, IMDb rating, runtime, genre, plot, domestic gross, directors, and actors.</p>
<pre class="r"><code>ranking&lt;- movies %&gt;%
  html_nodes(&quot;.text-primary&quot;) %&gt;%
  html_text() %&gt;%
  as.numeric()
head(ranking)</code></pre>
<pre><code>## [1] 1 2 3 4 5 6</code></pre>
<pre class="r"><code>rating &lt;- movies %&gt;%
  html_nodes(&quot;.certificate&quot;) %&gt;%
  html_text()
head(rating)</code></pre>
<pre><code>## [1] &quot;PG-13&quot; &quot;PG-13&quot; &quot;PG-13&quot; &quot;R&quot;     &quot;PG-13&quot; &quot;PG-13&quot;</code></pre>
<pre class="r"><code>IMDb_rating &lt;- movies %&gt;%
  html_nodes(&quot;.ratings-imdb-rating strong&quot;) %&gt;%
  html_text() %&gt;%
  as.numeric()
head(IMDb_rating)</code></pre>
<pre><code>## [1] 8.4 9.0 6.9 7.6 7.0 8.4</code></pre>
<pre class="r"><code>runtime &lt;- movies %&gt;%
  html_nodes(&quot;.runtime&quot;) %&gt;%
  html_text() %&gt;% # translating from a character string to numeric vector
  str_sub(1,-5) %&gt;%
  as.integer()
head(runtime)</code></pre>
<pre><code>## [1] 181 152 144 162 143 149</code></pre>
<pre class="r"><code>genre &lt;- movies %&gt;%
  html_nodes(&quot;.genre&quot;) %&gt;%
  html_text() %&gt;% # cleaning character string
  str_remove(&quot;^\\n&quot;) %&gt;%
  str_squish()
head(genre)</code></pre>
<pre><code>## [1] &quot;Action, Adventure, Drama&quot;   &quot;Action, Crime, Drama&quot;      
## [3] &quot;Action, Adventure, Sci-Fi&quot;  &quot;Action, Drama, Mystery&quot;    
## [5] &quot;Action, Adventure, Fantasy&quot; &quot;Action, Adventure, Sci-Fi&quot;</code></pre>
<pre class="r"><code>plot &lt;- movies %&gt;%
  html_nodes(&quot;.ratings-bar+ p&quot;) %&gt;%
  html_text() %&gt;% # cleaning up character strings
  str_remove(&quot;^\\n\\s+&quot;)
head(plot)</code></pre>
<pre><code>## [1] &quot;After the devastating events of Avengers: Infinity War (2018), the universe is in ruins. With the help of remaining allies, the Avengers assemble once more in order to reverse Thanos&#39; actions and restore balance to the universe.&quot;
## [2] &quot;When the menace known as the Joker wreaks havoc and chaos on the people of Gotham, Batman must accept one of the greatest psychological and physical tests of his ability to fight injustice.&quot;                                       
## [3] &quot;In the 1980s the X-Men must defeat an ancient all-powerful mutant, En Sabah Nur, who intends to thrive through bringing destruction to the world.&quot;                                                                                   
## [4] &quot;In 1985 where former superheroes exist, the murder of a colleague sends active vigilante Rorschach into his own sprawling investigation, uncovering something that could completely change the course of history as we know it.&quot;     
## [5] &quot;Arthur Curry, the human-born heir to the underwater kingdom of Atlantis, goes on a quest to prevent a war between the worlds of ocean and land.&quot;                                                                                     
## [6] &quot;The Avengers and their allies must be willing to sacrifice all in an attempt to defeat the powerful Thanos before his blitz of devastation and ruin puts an end to the universe.&quot;</code></pre>
<pre class="r"><code>gross_domestic &lt;- movies %&gt;%
  html_nodes(&quot;.ghost~ .text-muted+ span&quot;) %&gt;%
  html_text() %&gt;% # translating from a character string into a numeric vector
  str_remove_all(&quot;^\\$|M$&quot;) %&gt;% # all of our entries are in millions so easy to convert
  as.numeric() * 1e6
head(gross_domestic)</code></pre>
<pre><code>## [1] 858370000 534860000 155440000 107510000 335060000 678820000</code></pre>
<pre class="r"><code>directors1 &lt;- movies %&gt;%
  html_nodes(&quot;.text-small a:nth-child(1)&quot;) %&gt;%
  html_text()
head(directors1)</code></pre>
<pre><code>## [1] &quot;Anthony Russo&quot;     &quot;Christopher Nolan&quot; &quot;Bryan Singer&quot;     
## [4] &quot;Zack Snyder&quot;       &quot;James Wan&quot;         &quot;Anthony Russo&quot;</code></pre>
<pre class="r"><code>length(directors1)</code></pre>
<pre><code>## [1] 50</code></pre>
<pre class="r"><code>directors2 &lt;- movies %&gt;%
  html_nodes(&quot;.text-small a:nth-child(1) , .text-small a:nth-child(2)&quot;) %&gt;%
  html_text()
head(directors2)</code></pre>
<pre><code>## [1] &quot;Anthony Russo&quot;     &quot;Joe Russo&quot;         &quot;Christopher Nolan&quot;
## [4] &quot;Bryan Singer&quot;      &quot;Zack Snyder&quot;       &quot;James Wan&quot;</code></pre>
<pre class="r"><code>length(directors2)</code></pre>
<pre><code>## [1] 57</code></pre>
<pre class="r"><code>actors1 &lt;- movies %&gt;%
  html_nodes(&quot;.text-small .ghost+ a&quot;) %&gt;%
  html_text()
head(actors1)</code></pre>
<pre><code>## [1] &quot;Robert Downey Jr.&quot;  &quot;Christian Bale&quot;     &quot;James McAvoy&quot;      
## [4] &quot;Jackie Earle Haley&quot; &quot;Jason Momoa&quot;        &quot;Robert Downey Jr.&quot;</code></pre>
<pre class="r"><code>length(actors1)</code></pre>
<pre><code>## [1] 50</code></pre>
<pre class="r"><code>actors2 &lt;- movies %&gt;%
  html_nodes(&quot;.text-small .ghost~ a&quot;) %&gt;%
  html_text()
head(actors2)</code></pre>
<pre><code>## [1] &quot;Robert Downey Jr.&quot; &quot;Chris Evans&quot;       &quot;Mark Ruffalo&quot;     
## [4] &quot;Chris Hemsworth&quot;   &quot;Christian Bale&quot;    &quot;Heath Ledger&quot;</code></pre>
<pre class="r"><code>length(actors2)</code></pre>
<pre><code>## [1] 200</code></pre>
<p>For the most part we cleaned each vector we compiled as we extracted the data. Take note of the actor and director variables though. <code>director1</code> and <code>actor1</code> each have a length of 50 (matching the rest of the data). <code>director2</code> and <code>actor2</code> have more entries though, because all the movies on the list have more than one actor, and some have multiple directors.</p>
<p>To rectify this we will combine concatentate these strings with <code>str_c</code> using <code>for</code> loops. To do this, we will index the directors by appearance in the <code>directors1</code> and by taking groupings of four actors (as four actors are listed for each movie).</p>
<pre class="r"><code>ind &lt;- which(directors2 %in% directors1) %&gt;% append(length(directors2)+1)
directors &lt;- c()
for (i in 1:(length(ind)-1)){
  directors[i] &lt;- str_c(directors2[c(ind[i]:(ind[i+1]-1))], collapse = &quot;, &quot;)
}
head(directors)</code></pre>
<pre><code>## [1] &quot;Anthony Russo, Joe Russo&quot; &quot;Christopher Nolan&quot;       
## [3] &quot;Bryan Singer&quot;             &quot;Zack Snyder&quot;             
## [5] &quot;James Wan&quot;                &quot;Anthony Russo, Joe Russo&quot;</code></pre>
<pre class="r"><code>actors &lt;- c()
for(i in 1:length(actors1)){
  actors[i] &lt;- str_c(actors2[c(((i-1) * 4 + 1):(4 * i))], collapse = &quot;, &quot;)
}
head(actors)</code></pre>
<pre><code>## [1] &quot;Robert Downey Jr., Chris Evans, Mark Ruffalo, Chris Hemsworth&quot;      
## [2] &quot;Christian Bale, Heath Ledger, Aaron Eckhart, Michael Caine&quot;         
## [3] &quot;James McAvoy, Michael Fassbender, Jennifer Lawrence, Nicholas Hoult&quot;
## [4] &quot;Jackie Earle Haley, Patrick Wilson, Carla Gugino, Malin Akerman&quot;    
## [5] &quot;Jason Momoa, Amber Heard, Willem Dafoe, Patrick Wilson&quot;             
## [6] &quot;Robert Downey Jr., Chris Hemsworth, Mark Ruffalo, Chris Evans&quot;</code></pre>
<p>We now have most of the primary data we were searching for. Now lets combine it into a functioning data frame.</p>
<pre class="r"><code>superhero_movies &lt;- tibble(
  titles,
  popularity_rank = ranking,
  IMDb_rating,
  rating,
  runtime,
  genre,
  gross_domestic,
  plot,
  directors,
  actors
)
str(superhero_movies)</code></pre>
<pre><code>## tibble [50 × 10] (S3: tbl_df/tbl/data.frame)
##  $ titles         : chr [1:50] &quot;Avengers: Endgame&quot; &quot;The Dark Knight&quot; &quot;X-Men: Apocalypse&quot; &quot;Watchmen&quot; ...
##  $ popularity_rank: num [1:50] 1 2 3 4 5 6 7 8 9 10 ...
##  $ IMDb_rating    : num [1:50] 8.4 9 6.9 7.6 7 8.4 8.4 6.3 8 7.6 ...
##  $ rating         : chr [1:50] &quot;PG-13&quot; &quot;PG-13&quot; &quot;PG-13&quot; &quot;R&quot; ...
##  $ runtime        : int [1:50] 181 152 144 162 143 149 164 120 121 136 ...
##  $ genre          : chr [1:50] &quot;Action, Adventure, Drama&quot; &quot;Action, Crime, Drama&quot; &quot;Action, Adventure, Sci-Fi&quot; &quot;Action, Drama, Mystery&quot; ...
##  $ gross_domestic : num [1:50] 8.58e+08 5.35e+08 1.55e+08 1.08e+08 3.35e+08 ...
##  $ plot           : chr [1:50] &quot;After the devastating events of Avengers: Infinity War (2018), the universe is in ruins. With the help of remai&quot;| __truncated__ &quot;When the menace known as the Joker wreaks havoc and chaos on the people of Gotham, Batman must accept one of th&quot;| __truncated__ &quot;In the 1980s the X-Men must defeat an ancient all-powerful mutant, En Sabah Nur, who intends to thrive through &quot;| __truncated__ &quot;In 1985 where former superheroes exist, the murder of a colleague sends active vigilante Rorschach into his own&quot;| __truncated__ ...
##  $ directors      : chr [1:50] &quot;Anthony Russo, Joe Russo&quot; &quot;Christopher Nolan&quot; &quot;Bryan Singer&quot; &quot;Zack Snyder&quot; ...
##  $ actors         : chr [1:50] &quot;Robert Downey Jr., Chris Evans, Mark Ruffalo, Chris Hemsworth&quot; &quot;Christian Bale, Heath Ledger, Aaron Eckhart, Michael Caine&quot; &quot;James McAvoy, Michael Fassbender, Jennifer Lawrence, Nicholas Hoult&quot; &quot;Jackie Earle Haley, Patrick Wilson, Carla Gugino, Malin Akerman&quot; ...</code></pre>
<p>There is one more feauture of <code>rvest</code> I would like to illustrate before we close out this tutorial, and that is how to extract links.</p>
<p>We will add one more column to our new data frame that gives the link to each movie’s page using <code>html_attr</code>. All we need to do is add one more input, “href”, which tells the function we want the link, not the text of the CSS tag element.</p>
<pre class="r"><code>pages &lt;- movies %&gt;%
  html_nodes(&quot;.lister-item-header a&quot;) %&gt;%
  html_attr(&quot;href&quot;)
head(pages)</code></pre>
<pre><code>## [1] &quot;/title/tt4154796/?ref_=kw_li_tt&quot; &quot;/title/tt0468569/?ref_=kw_li_tt&quot;
## [3] &quot;/title/tt3385516/?ref_=kw_li_tt&quot; &quot;/title/tt0409459/?ref_=kw_li_tt&quot;
## [5] &quot;/title/tt1477834/?ref_=kw_li_tt&quot; &quot;/title/tt4154756/?ref_=kw_li_tt&quot;</code></pre>
<p>This now gives us the addres’s within the main website, to get the full urls all we have to do is add the main site address to the start of each string.</p>
<pre class="r"><code>pages &lt;- str_c(&quot;https://www.imdb.com&quot;, pages)
superhero_movies &lt;- cbind(superhero_movies, pages)
superhero_movies %&gt;% head()</code></pre>
<pre><code>##                   titles popularity_rank IMDb_rating rating runtime
## 1      Avengers: Endgame               1         8.4  PG-13     181
## 2        The Dark Knight               2         9.0  PG-13     152
## 3      X-Men: Apocalypse               3         6.9  PG-13     144
## 4               Watchmen               4         7.6      R     162
## 5                Aquaman               5         7.0  PG-13     143
## 6 Avengers: Infinity War               6         8.4  PG-13     149
##                        genre gross_domestic
## 1   Action, Adventure, Drama      858370000
## 2       Action, Crime, Drama      534860000
## 3  Action, Adventure, Sci-Fi      155440000
## 4     Action, Drama, Mystery      107510000
## 5 Action, Adventure, Fantasy      335060000
## 6  Action, Adventure, Sci-Fi      678820000
##                                                                                                                                                                                                                                   plot
## 1 After the devastating events of Avengers: Infinity War (2018), the universe is in ruins. With the help of remaining allies, the Avengers assemble once more in order to reverse Thanos&#39; actions and restore balance to the universe.
## 2                                        When the menace known as the Joker wreaks havoc and chaos on the people of Gotham, Batman must accept one of the greatest psychological and physical tests of his ability to fight injustice.
## 3                                                                                    In the 1980s the X-Men must defeat an ancient all-powerful mutant, En Sabah Nur, who intends to thrive through bringing destruction to the world.
## 4      In 1985 where former superheroes exist, the murder of a colleague sends active vigilante Rorschach into his own sprawling investigation, uncovering something that could completely change the course of history as we know it.
## 5                                                                                      Arthur Curry, the human-born heir to the underwater kingdom of Atlantis, goes on a quest to prevent a war between the worlds of ocean and land.
## 6                                                     The Avengers and their allies must be willing to sacrifice all in an attempt to defeat the powerful Thanos before his blitz of devastation and ruin puts an end to the universe.
##                  directors
## 1 Anthony Russo, Joe Russo
## 2        Christopher Nolan
## 3             Bryan Singer
## 4              Zack Snyder
## 5                James Wan
## 6 Anthony Russo, Joe Russo
##                                                                actors
## 1       Robert Downey Jr., Chris Evans, Mark Ruffalo, Chris Hemsworth
## 2          Christian Bale, Heath Ledger, Aaron Eckhart, Michael Caine
## 3 James McAvoy, Michael Fassbender, Jennifer Lawrence, Nicholas Hoult
## 4     Jackie Earle Haley, Patrick Wilson, Carla Gugino, Malin Akerman
## 5              Jason Momoa, Amber Heard, Willem Dafoe, Patrick Wilson
## 6       Robert Downey Jr., Chris Hemsworth, Mark Ruffalo, Chris Evans
##                                                 pages
## 1 https://www.imdb.com/title/tt4154796/?ref_=kw_li_tt
## 2 https://www.imdb.com/title/tt0468569/?ref_=kw_li_tt
## 3 https://www.imdb.com/title/tt3385516/?ref_=kw_li_tt
## 4 https://www.imdb.com/title/tt0409459/?ref_=kw_li_tt
## 5 https://www.imdb.com/title/tt1477834/?ref_=kw_li_tt
## 6 https://www.imdb.com/title/tt4154756/?ref_=kw_li_tt</code></pre>
<p>And viola! We have taken the contents of a webpage and turned it into a useful dataframe tracking superhero movies and all of their attached statistics.</p>
</div>
<div id="rselenium" class="section level3">
<h3><code>rselenium</code></h3>
<p>For the most part we cleaned each vector we compiled as we extracted the data. Take note of the actor and director variables though. <code>director1</code> and <code>actor1</code> each have a length of 50 (matching the rest of the data). <code>director2</code> and <code>actor2</code> have more entries though, because all the movies on the list have more than one actor, and some have multiple directors.</p>
<p>To rectify this we will combine concatentate these strings with <code>str_c</code> using <code>for</code> loops. To do this, we will index the directors by appearance in the <code>directors1</code> and by taking groupings of four actors (as four actors are listed for each movie).</p>
<pre class="r"><code>ind &lt;- which(directors2 %in% directors1) %&gt;% append(length(directors2)+1)
directors &lt;- c()
for (i in 1:(length(ind)-1)){
  directors[i] &lt;- str_c(directors2[c(ind[i]:(ind[i+1]-1))], collapse = &quot;, &quot;)
}
head(directors)</code></pre>
<pre><code>## [1] &quot;Anthony Russo, Joe Russo&quot; &quot;Christopher Nolan&quot;       
## [3] &quot;Bryan Singer&quot;             &quot;Zack Snyder&quot;             
## [5] &quot;James Wan&quot;                &quot;Anthony Russo, Joe Russo&quot;</code></pre>
<pre class="r"><code>actors &lt;- c()
for(i in 1:length(actors1)){
  actors[i] &lt;- str_c(actors2[c(((i-1) * 4 + 1):(4 * i))], collapse = &quot;, &quot;)
}
head(actors)</code></pre>
<pre><code>## [1] &quot;Robert Downey Jr., Chris Evans, Mark Ruffalo, Chris Hemsworth&quot;      
## [2] &quot;Christian Bale, Heath Ledger, Aaron Eckhart, Michael Caine&quot;         
## [3] &quot;James McAvoy, Michael Fassbender, Jennifer Lawrence, Nicholas Hoult&quot;
## [4] &quot;Jackie Earle Haley, Patrick Wilson, Carla Gugino, Malin Akerman&quot;    
## [5] &quot;Jason Momoa, Amber Heard, Willem Dafoe, Patrick Wilson&quot;             
## [6] &quot;Robert Downey Jr., Chris Hemsworth, Mark Ruffalo, Chris Evans&quot;</code></pre>
<p>We now have most of the primary data we were searching for. Now lets combine it into a functioning data frame.</p>
<pre class="r"><code>superhero_movies &lt;- tibble(
  titles,
  popularity_rank = ranking,
  IMDb_rating,
  rating,
  runtime,
  genre,
  gross_domestic,
  plot,
  directors,
  actors
)
str(superhero_movies)</code></pre>
<pre><code>## tibble [50 × 10] (S3: tbl_df/tbl/data.frame)
##  $ titles         : chr [1:50] &quot;Avengers: Endgame&quot; &quot;The Dark Knight&quot; &quot;X-Men: Apocalypse&quot; &quot;Watchmen&quot; ...
##  $ popularity_rank: num [1:50] 1 2 3 4 5 6 7 8 9 10 ...
##  $ IMDb_rating    : num [1:50] 8.4 9 6.9 7.6 7 8.4 8.4 6.3 8 7.6 ...
##  $ rating         : chr [1:50] &quot;PG-13&quot; &quot;PG-13&quot; &quot;PG-13&quot; &quot;R&quot; ...
##  $ runtime        : int [1:50] 181 152 144 162 143 149 164 120 121 136 ...
##  $ genre          : chr [1:50] &quot;Action, Adventure, Drama&quot; &quot;Action, Crime, Drama&quot; &quot;Action, Adventure, Sci-Fi&quot; &quot;Action, Drama, Mystery&quot; ...
##  $ gross_domestic : num [1:50] 8.58e+08 5.35e+08 1.55e+08 1.08e+08 3.35e+08 ...
##  $ plot           : chr [1:50] &quot;After the devastating events of Avengers: Infinity War (2018), the universe is in ruins. With the help of remai&quot;| __truncated__ &quot;When the menace known as the Joker wreaks havoc and chaos on the people of Gotham, Batman must accept one of th&quot;| __truncated__ &quot;In the 1980s the X-Men must defeat an ancient all-powerful mutant, En Sabah Nur, who intends to thrive through &quot;| __truncated__ &quot;In 1985 where former superheroes exist, the murder of a colleague sends active vigilante Rorschach into his own&quot;| __truncated__ ...
##  $ directors      : chr [1:50] &quot;Anthony Russo, Joe Russo&quot; &quot;Christopher Nolan&quot; &quot;Bryan Singer&quot; &quot;Zack Snyder&quot; ...
##  $ actors         : chr [1:50] &quot;Robert Downey Jr., Chris Evans, Mark Ruffalo, Chris Hemsworth&quot; &quot;Christian Bale, Heath Ledger, Aaron Eckhart, Michael Caine&quot; &quot;James McAvoy, Michael Fassbender, Jennifer Lawrence, Nicholas Hoult&quot; &quot;Jackie Earle Haley, Patrick Wilson, Carla Gugino, Malin Akerman&quot; ...</code></pre>
<p>There is one more feauture of <code>rvest</code> I would like to illustrate before we close out this tutorial, and that is how to extract links.</p>
<p>We will add one more column to our new data frame that gives the link to each movie’s page using <code>html_attr</code>. All we need to do is add one more input, “href”, which tells the function we want the link, not the text of the CSS tag element.</p>
<pre class="r"><code>pages &lt;- movies %&gt;%
  html_nodes(&quot;.lister-item-header a&quot;) %&gt;%
  html_attr(&quot;href&quot;)
head(pages)</code></pre>
<pre><code>## [1] &quot;/title/tt4154796/?ref_=kw_li_tt&quot; &quot;/title/tt0468569/?ref_=kw_li_tt&quot;
## [3] &quot;/title/tt3385516/?ref_=kw_li_tt&quot; &quot;/title/tt0409459/?ref_=kw_li_tt&quot;
## [5] &quot;/title/tt1477834/?ref_=kw_li_tt&quot; &quot;/title/tt4154756/?ref_=kw_li_tt&quot;</code></pre>
<p>This now gives us the addres’s within the main website, to get the full urls all we have to do is add the main site address to the start of each string.</p>
<pre class="r"><code>pages &lt;- str_c(&quot;https://www.imdb.com&quot;, pages)

superhero_movies &lt;- cbind(superhero_movies, pages)
superhero_movies %&gt;% head()</code></pre>
<pre><code>##                   titles popularity_rank IMDb_rating rating runtime
## 1      Avengers: Endgame               1         8.4  PG-13     181
## 2        The Dark Knight               2         9.0  PG-13     152
## 3      X-Men: Apocalypse               3         6.9  PG-13     144
## 4               Watchmen               4         7.6      R     162
## 5                Aquaman               5         7.0  PG-13     143
## 6 Avengers: Infinity War               6         8.4  PG-13     149
##                        genre gross_domestic
## 1   Action, Adventure, Drama      858370000
## 2       Action, Crime, Drama      534860000
## 3  Action, Adventure, Sci-Fi      155440000
## 4     Action, Drama, Mystery      107510000
## 5 Action, Adventure, Fantasy      335060000
## 6  Action, Adventure, Sci-Fi      678820000
##                                                                                                                                                                                                                                   plot
## 1 After the devastating events of Avengers: Infinity War (2018), the universe is in ruins. With the help of remaining allies, the Avengers assemble once more in order to reverse Thanos&#39; actions and restore balance to the universe.
## 2                                        When the menace known as the Joker wreaks havoc and chaos on the people of Gotham, Batman must accept one of the greatest psychological and physical tests of his ability to fight injustice.
## 3                                                                                    In the 1980s the X-Men must defeat an ancient all-powerful mutant, En Sabah Nur, who intends to thrive through bringing destruction to the world.
## 4      In 1985 where former superheroes exist, the murder of a colleague sends active vigilante Rorschach into his own sprawling investigation, uncovering something that could completely change the course of history as we know it.
## 5                                                                                      Arthur Curry, the human-born heir to the underwater kingdom of Atlantis, goes on a quest to prevent a war between the worlds of ocean and land.
## 6                                                     The Avengers and their allies must be willing to sacrifice all in an attempt to defeat the powerful Thanos before his blitz of devastation and ruin puts an end to the universe.
##                  directors
## 1 Anthony Russo, Joe Russo
## 2        Christopher Nolan
## 3             Bryan Singer
## 4              Zack Snyder
## 5                James Wan
## 6 Anthony Russo, Joe Russo
##                                                                actors
## 1       Robert Downey Jr., Chris Evans, Mark Ruffalo, Chris Hemsworth
## 2          Christian Bale, Heath Ledger, Aaron Eckhart, Michael Caine
## 3 James McAvoy, Michael Fassbender, Jennifer Lawrence, Nicholas Hoult
## 4     Jackie Earle Haley, Patrick Wilson, Carla Gugino, Malin Akerman
## 5              Jason Momoa, Amber Heard, Willem Dafoe, Patrick Wilson
## 6       Robert Downey Jr., Chris Hemsworth, Mark Ruffalo, Chris Evans
##                                                 pages
## 1 https://www.imdb.com/title/tt4154796/?ref_=kw_li_tt
## 2 https://www.imdb.com/title/tt0468569/?ref_=kw_li_tt
## 3 https://www.imdb.com/title/tt3385516/?ref_=kw_li_tt
## 4 https://www.imdb.com/title/tt0409459/?ref_=kw_li_tt
## 5 https://www.imdb.com/title/tt1477834/?ref_=kw_li_tt
## 6 https://www.imdb.com/title/tt4154756/?ref_=kw_li_tt</code></pre>
<p>And viola! We have taken the contents of a webpage and turned it into a useful dataframe tracking superhero movies and all of their attached statistics.</p>
</div>
<div id="rselenium-1" class="section level3">
<h3><code>rselenium</code></h3>
</div>

  </div>
  

<div class="navigation navigation-single">
    
    
    <a href="/analytics/processing-text-data/" class="navigation-next">
      <span class="navigation-tittle">Processing Text Data</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    



    



    </body>
</html>
